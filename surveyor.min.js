function Strip1(){var e=document.getElementById("strip1-fg"),t=e.getContext("2d"),i=viewportWidth/2,r=viewportHeight/2,o=i,n=r,a=175,s=1.5,h=210,d=125,l=1.5,w=1,f=140,c=60,p=new Image;p.src="stars.gif";var g=0,m=2e-4,v=[new Firefly((viewportWidth-16)*Math.random()+8,(viewportHeight-16)*Math.random()+8,105,60),new Firefly((viewportWidth-16)*Math.random()+8,(viewportHeight-16)*Math.random()+8,140,120),new Firefly((viewportWidth-16)*Math.random()+8,(viewportHeight-16)*Math.random()+8,60,180),new Firefly((viewportWidth-16)*Math.random()+8,(viewportHeight-16)*Math.random()+8,90,240),new Firefly((viewportWidth-16)*Math.random()+8,(viewportHeight-16)*Math.random()+8,75,300),new Firefly((viewportWidth-16)*Math.random()+8,(viewportHeight-16)*Math.random()+8,130,0)],u=[new ImgObject("lighted.png","lighted-shadow.png",0,0)],b=[new ImgObject("rocks.png",null,0,0,"destination-over"),new ImgObject("streetlights.png",null,0,0,"destination-over")],y=[new Frame("reeds.png",0),new Frame("reeds-red.png",1e3)],F=[new AnimObject(y,2e3,0,0)];this.tick=function(){if($("#strip1").visible(!0)){t.clearRect(0,0,viewportWidth,viewportHeight),timeElapsed=(new Date).getTime()-START_TIME;var e;for(e=0;e<v.length;e++)this.renderFirefly(v[e]);for(this.renderSelf(),e=0;e<u.length;e++)this.renderObject(u[e]);for(e=0;e<b.length;e++)this.renderObject(b[e]);t.save(),t.globalCompositeOperation="destination-over";var i=t.createLinearGradient(0,0,0,viewportHeight);for(i.addColorStop(0,"transparent"),i.addColorStop(1,"rgba(219, 170, 237, 0.8)"),t.fillStyle=i,t.fillRect(0,0,viewportWidth,viewportHeight),t.translate(viewportWidth/2,viewportHeight/2),t.rotate(g),t.drawImage(p,1.5*-viewportWidth,1.5*-viewportHeight,3*viewportWidth,3*viewportHeight),g+=m,t.restore(),e=0;e<v.length;e++)this.renderFirefly(v[e]),this.tickFirefly(v[e]);for(this.renderSelf(),this.tickSelf(),e=0;e<F.length;e++)this.renderObject(F[e])}},this.renderSelf=function(){t.save();var e=t.createRadialGradient(o,n,0,o,n,a/2);e.addColorStop(0,"rgb(204, 204, 160)"),e.addColorStop(.1,"rgba(77, 77, 68, 0.5)"),e.addColorStop(.33,"rgba(66, 66, 66, 0.3)"),e.addColorStop(1,"transparent"),t.globalCompositeOperation="screen",t.fillStyle=e,t.fillRect(o-a/2,n-a/2,a,a),t.restore()},this.tickSelf=function(){if(Math.abs(i-o)>1||Math.abs(r-n)>1){var e=i-o,t=e/8;o+=t,e=r-n,t=e/8,n+=t}(a>h||d>a)&&(s*=-1),a+=s},this.renderFirefly=function(e){t.save();var i=t.createRadialGradient(e.x,e.y,0,e.x,e.y,e.size/2);i.addColorStop(0,"rgb(153, 153, 153)"),i.addColorStop(.1,"rgba(61, 61, 61, 0.5)"),i.addColorStop(.33,"rgba(40, 40, 40, 0.3)"),i.addColorStop(1,"transparent"),t.globalCompositeOperation="screen",t.fillStyle=i,t.fillRect(e.x-e.size/2,e.y-e.size/2,e.size,e.size),t.restore()},this.tickFirefly=function(e){var t=o-e.x,i=n-e.y,r=Math.abs(t),a=Math.abs(i);if((e.size>f||e.size<c)&&(e.dsize*=-1),e.size+=e.dsize,60>r&&60>a?e.follow=!0:(r>90||a>90)&&(e.follow=!1),e.follow&&(r>8||a>8)){var s=t/14;s>10&&(s=10),e.x+=s,s=i/14,s>10&&(s=10),e.y+=s}e.angle+=w*Math.PI/180,e.x+=l*Math.cos(e.angle),e.y+=l*Math.sin(e.angle),e.x>viewportWidth?e.x=viewportWidth:e.x<0&&(e.x=0),e.y>viewportHeight?e.y=viewportHeight:e.y<0&&(e.y=0)},this.renderObject=function(e){if(e instanceof ImgObject)t.save(),t.scale(scaleFactor,scaleFactor),null!==e.shadow?(t.globalCompositeOperation="source-atop",t.drawImage(e.img,2e3-e.img.width-e.x,2e3*viewportHeight/viewportWidth-e.img.height-e.y),t.globalCompositeOperation="destination-over",t.drawImage(e.shadow,2e3-e.img.width-e.x,2e3*viewportHeight/viewportWidth-e.img.height-e.y)):(t.globalCompositeOperation=e.blendmode,t.drawImage(e.img,2e3-e.img.width-e.x,2e3*viewportHeight/viewportWidth-e.img.height-e.y)),t.restore();else{if(!(e instanceof AnimObject))throw new TypeError("An object in the scene must be an AnimObject or an ImgObject");t.save(),t.scale(scaleFactor,scaleFactor);var i=e.getFrame(timeElapsed).img;t.drawImage(i,2e3-i.width-e.x,2e3*viewportHeight/viewportWidth-i.height-e.y),t.restore()}},this.handleMouse=function(t){void 0!==t.pageX&&void 0!==t.pageY?(i=t.pageX,r=t.pageY):(i=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),i-=e.offsetLeft,r-=e.offsetTop},this.forceRedraw=function(){t.canvas.width=viewportWidth,t.canvas.height=viewportHeight},this.init=function(){this.forceRedraw(),e.addEventListener("mousemove",strip1.handleMouse,!1)}}function Strip2(){var t=document.getElementById("strip1-fg"),i=t.getContext("2d"),r=viewportWidth/2,o=r,n=[];this.tick=function(){if($("#strip2").visible(!0)){var t,e=r-o;for(Math.abs(e)>1&&(o+=e/8),t=0;t<n.length;t++);}},this.handleMouse=function(){r=void 0!==e.pageX&&void 0!==e.pageY?e.pageX:e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r-=t.offsetLeft},this.forceRedraw=function(){i.canvas.width=viewportWidth,i.canvas.height=viewportHeight},this.init=function(){this.forceRedraw(),t.addEventListener("mousemove",strip2.handleMouse,!1)}}function Firefly(e,t,i,r){this.x=e,this.y=t,this.size=i,this.dsize=Math.random()<.5?-1:1,this.angle=r*Math.PI/180,this.follow=!1}function ImgObject(e,t,i,r,o){var n=new Image;if(n.src=e,this.img=n,null!==t){var a=new Image;a.src=t,this.shadow=a}else this.shadow=null;this.x=i,this.y=r,this.blendmode=o}function Frame(e,t){var i=new Image;i.src=e,this.img=i,this.timestamp=t}function AnimObject(e,t,i,r){this.frames=e,this.length=t,this.x=i,this.y=r,this.getFrame=function(e){e%=this.length;var i,t=this.frames[0];for(i=0;i<this.frames.length;i++){var r=this.frames[i];if(!(e>r.timestamp)){if(e===r.timestamp)return r;break}t=r}return t}}function ParallaxObj(e,t,i,r){this.x=t,this.y=i,this.depth=r;var o=new Image;o.src=e,this.img=o}function viewport(){var e=$("#strip1"),t=e.height(),i=e.width();return{width:i,height:t}}function forceRedraw(){viewportWidth=viewport().width,viewportHeight=viewport().height,scaleFactor=viewportWidth/2e3,strip1.forceRedraw()}function tickAll(){setTimeout(function(){window.requestAnimFrame(tickAll),strip1.tick()},1e3/30)}var viewportWidth=viewport().width,viewportHeight=viewport().height,scaleFactor=viewportWidth/2e3,START_TIME=(new Date).getTime(),timeElapsed=0;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var strip1=new Strip1;strip1.init(),window.addEventListener("resize",forceRedraw,!1),tickAll();